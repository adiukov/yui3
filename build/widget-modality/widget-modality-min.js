YUI.add("widget-modality",function(t,e){var i,s,o,a,n,d,l="widget",h="renderUI",r="bindUI",u="syncUI",c="boundingBox",f="visible",g="zIndex",_="Change",M=t.Lang.isBoolean,b=t.ClassNameManager.getClassName,m="maskShow",I="maskHide",k="clickoutside",p="focusoutside",v=(n=t.config.doc,d=null,n.createElement&&(o=n.createElement("div"))&&o.style&&(o.style.position="fixed",(a=n.body)&&a.appendChild&&a.removeChild&&(a.appendChild(o),d="fixed"===o.style.position,a.removeChild(o))),d);function y(t){}i="mask",s={modal:b(l,"modal"),mask:b(l,i)},y.ATTRS={maskNode:{getter:"_getMaskNode",readOnly:!0},modal:{value:!1,validator:M},focusOn:{valueFn:function(){return[{eventName:k},{eventName:p}]},validator:t.Lang.isArray}},y.CLASSES=s,y._MASK=null,y._GET_MASK=function(){var e=y._MASK,i=t.one("win");return e&&null!==e.getDOMNode()&&e.inDoc()?e:(e=t.Node.create("<div></div>").addClass(s.mask),y._MASK=e,v?e.setStyles({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",display:"block"}):e.setStyles({position:"absolute",width:i.get("winWidth")+"px",height:i.get("winHeight")+"px",top:"0",left:"0",display:"block"}),e)},y.STACK=[],y.prototype={initializer:function(){t.after(this._renderUIModal,this,h),t.after(this._syncUIModal,this,u),t.after(this._bindUIModal,this,r)},destructor:function(){this._uiSetHostVisibleModal(!1)},_uiHandlesModal:null,_renderUIModal:function(){var t=this.get(c);this._repositionMask(this),t.addClass(s.modal)},_bindUIModal:function(){this.after(f+_,this._afterHostVisibleChangeModal),this.after(g+_,this._afterHostZIndexChangeModal),this.after("focusOnChange",this._afterFocusOnChange),(!v||t.UA.ios&&t.UA.ios<5||t.UA.android&&t.UA.android<3)&&t.one("win").on("scroll",this._resyncMask,this)},_syncUIModal:function(){this._uiSetHostVisibleModal(this.get(f))},_focus:function(){var t=this.get(c),e=t.get("tabIndex");t.set("tabIndex",e>=0?e:0),this.focus()},_blur:function(){this.blur()},_getMaskNode:function(){return y._GET_MASK()},_uiSetHostVisibleModal:function(e){var i,s,o=y.STACK,a=this.get("maskNode"),n=this.get("modal");e?(t.Array.each(o,function(t){t._detachUIHandlesModal(),t._blur()}),o.unshift(this),this._repositionMask(this),this._uiSetHostZIndexModal(this.get(g)),n&&(a.show(),t.later(1,this,"_attachUIHandlesModal"),this._focus(),this._blockIFrameFocus())):((s=t.Array.indexOf(o,this))>=0&&o.splice(s,1),this._detachUIHandlesModal(),this._blur(),o.length?(i=o[0],this._repositionMask(i),i._uiSetHostZIndexModal(i.get(g)),i.get("modal")&&(t.later(1,i,"_attachUIHandlesModal"),i._focus())):"block"===a.getStyle("display")&&a.hide(),this._unblockIFrameFocus())},_blockIFrameFocus:function(){var e=this.get(c);t.all("iframe").each(function(){e.contains(this)||(this.setAttribute("data-tabindex",this.get("tabIndex")),this.set("tabIndex",-1))})},_unblockIFrameFocus:function(){t.all("iframe").each(function(){this.hasAttribute("data-tabindex")&&(this.set("tabIndex",this.getAttribute("data-tabindex")),this.removeAttribute("data-tabindex"))})},_uiSetHostZIndexModal:function(t){this.get("modal")&&this.get("maskNode").setStyle(g,t||0)},_attachUIHandlesModal:function(){if(!this._uiHandlesModal&&y.STACK[0]===this){var e,i,s,o=this.get(c),a=this.get("maskNode"),n=this.get("focusOn"),d=t.bind(this._focus,this),l=[];for(e=0,i=n.length;e<i;e++)(s={}).node=n[e].node,s.ev=n[e].eventName,s.keyCode=n[e].keyCode,s.node||s.keyCode||!s.ev?s.node&&!s.keyCode&&s.ev?l.push(s.node.on(s.ev,d)):s.node&&s.keyCode&&s.ev&&l.push(s.node.on(s.ev,d,s.keyCode)):l.push(o.on(s.ev,d));v||l.push(t.one("win").on("scroll",t.bind(function(){a.setStyle("top",a.get("docScrollY"))},this))),this._uiHandlesModal=l}},_detachUIHandlesModal:function(){t.each(this._uiHandlesModal,function(t){t.detach()}),this._uiHandlesModal=null},_afterHostVisibleChangeModal:function(t){this._uiSetHostVisibleModal(t.newVal)},_afterHostZIndexChangeModal:function(t){this._uiSetHostZIndexModal(t.newVal)},isNested:function(){return y.STACK.length>1},_repositionMask:function(e){var i,s=this.get("modal"),o=e.get("modal"),a=this.get("maskNode");s&&!o?(a.remove(),this.fire(I)):(!s&&o||s&&o)&&(a.remove(),this.fire(I),(i=e.get(c).get("parentNode")||t.one("body")).insert(a,i.get("firstChild")),this.fire(m))},_resyncMask:function(t){var e=t.currentTarget,i=e.get("docScrollX"),s=e.get("docScrollY"),o=e.get("innerWidth")||e.get("winWidth"),a=e.get("innerHeight")||e.get("winHeight");this.get("maskNode").setStyles({top:s+"px",left:i+"px",width:o+"px",height:a+"px"})},_afterFocusOnChange:function(){this._detachUIHandlesModal(),this.get(f)&&this._attachUIHandlesModal()}},t.WidgetModality=y},"@VERSION@",{requires:["base-build","event-outside","widget"],skinnable:!0});